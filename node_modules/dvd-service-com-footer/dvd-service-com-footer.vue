<template>
    <!--底部菜单栏-->
    <div class="dvd-service-com-footer" v-if="!isDvdApp">
        <div class="btns">
            <a class="btn" v-for="(item,index) in btnList" :href="urlList.url[index]" :style="styleList[index]">
                <div class="pic-title">
                    <img class="pic" :src="useSkinPackageImg(btnList[index],btnList[index].default,index)">
                    <div class="title" :style="textList[index]" v-text="urlList.text[index]"></div>
                </div>
            </a>
        </div>
    </div>
</template>

<script>
    import ua from 'dvd-base-js-ua';
    import encrypt from 'dvd-service-js-encrypt';
    import $ from 'jquery';

    export default {
        props: {
            // 取值范围 home school configurable dynamic center
            active: {
                type: String,
                default: 'home'
            },
            cartNum: {
                type: Number,
                default: 0
            },
            // 皮肤，如果有则使用这个属性，可以获得更快的显示速度
            skin: {
                type: Array,
                default: null
            },
        },
        data() {
            return {
                isDvdApp: ua.isDvdApp(),
                bottomTab: [],
                bottomStyle: [],
                textList:[],
                urlList:{},
                store: [],
                defauitImgList:[
                    "//pic.davdian.com/free/footer-icon/home.png",
                    "//pic.davdian.com/free/footer-icon/school.png",
                    "",
                    "//pic.davdian.com/free/footer-icon/dynamic.png?2",
                    "//pic.davdian.com/free/footer-icon/center.png"
                ],
                activeImgList:[
                    "//pic.davdian.com/free/footer-icon/home-active.png",
                    "//pic.davdian.com/free/footer-icon/school-active.png",
                    "",
                    "//pic.davdian.com/free/footer-icon/dynamic-active.png?2",
                    "//pic.davdian.com/free/footer-icon/center-active.png"
                ]
            }
        },
        computed: {
            btnList: function () {
                return this.bottomTab;
            },
            styleList: function () {
                return this.bottomStyle;
            }
        },
        created() {
            this.useSkinpackageFromLocal();
        },
        watch: {
            store: {
                handler: function (val, oldval) {
                    this.useSkinpackage(val);
                },
                deep: true
            }
        },
        methods: {
            activeHandle(index){
                var arr=["home","school","configurable","dynamic","center"];
                return this.active == arr[index];
            },
            changStyle(json) {
                //初始化数组
                this.bottomTab = [];
                this.bottomStyle = [];
                this.textList = [];
                this.urlList.url = ["/","/course.html","#","/articles.html","/center.html"];
                this.urlList.text = ["首页","学院","会员","动态","我的"];
                json["10"].listData.map((item,index)=>{
                    var _this=this;
                    this.bottomTab.push({
                        defaultImage: item.normalImagePath ? item.normalImagePath : "",
                        selectedImage: item.selectedImagePath ? item.selectedImagePath : "",
                        //默认图片
                        default:{
                            defaultImg:this.defauitImgList[index],
                            active:this.activeImgList[index]
                        }
                    });
                    if(item.marginTop){
                        this.$set(this.bottomStyle,index,{"marginTop": item.marginTop / 100 + "rem"});
                    }else{
                        this.$set(this.bottomStyle,index,{"marginTop": "0"});
                    }
                    if(item.showActivityUrl){
                        console.log("--------");
                        this.$set(this.urlList.url,index,item.showActivityUrl);
                    }
                    if(item.text){
                        this.$set(this.urlList.text,index,item.text);
                    }
                    this.textList.push((function (index) {
                        if(_this.activeHandle(index)){
                            if(item.selectedColor){
                                return {"color":"#" + item.selectedColor.substr(2)};
                            }else{
                                return {"color":"#FF4A7D"};
                            }
                        }else{
                            if(item.normalColor){
                                return {"color":"#" + item.normalColor.substr(2)};
                            }else{
                                return {"color":"#999999"};
                            }
                        }
                    })(index))
                })
            },
            //读取本地的数据
            useSkinpackageFromLocal() {
                var that = this;
                try {
                    if (this.skin || localStorage.getItem("skinPackage")) {
                        var skinInfo = this.skin || JSON.parse((localStorage.getItem("skinPackage")));
                        skinInfo.map(function (item, index) {
                            var now = new Date().getTime().toString().substr(0, 10);
                            var startTime = item.startTime;
                            var endTime = item.endTime;
                            if (parseInt(startTime) <= parseInt(now) && parseInt(endTime) > parseInt(now)) {
                                that.changStyle(JSON.parse(item.viewFileUrl));
                            }
                        });
                    }
                } catch (err) {
                }
            },
            //根据传入的值改变样式
            useSkinpackage(data) {
                var that = this;
                data.map(function (item, index) {
                    var now = new Date().getTime().toString().substr(0, 10);
                    var startTime = item.startTime;
                    var endTime = item.endTime;
                    if (parseInt(startTime) <= parseInt(now) && parseInt(endTime) > parseInt(now)) {
                        that.changStyle(JSON.parse(item.viewFileUrl));
                    }
                });
            },
            useSkinPackageImg(newImg, oldImg, index) {
                if (this.activeHandle(index)) {//selectedImage
                    if (newImg.selectedImage) {
                        //配了
                        return newImg.selectedImage;
                    }
                    return oldImg.active;
                } else {//defaultImage
                    if (newImg.defaultImage) {
                        //配了
                        return newImg.defaultImage;
                    }
                    return oldImg.default;
                }
            },
            /**
             * 接口名称:
             * 接口文档:
             */
            getData() {
                let ts = this;
                $.ajax({
                    cache: false,
                    async: true,
                    url: '/api/m/index/cart?_=' + Date.now(),
                    type: 'post',
                    dataType: 'json',
                    data: encrypt({}),
                    success(response) {
                        ts.response = response;
                    },
                    error(error) {
//      ts.response = require('../json/center.json');
                        console.error('ajax error:' + error.status + ' ' + error.statusText);
                    }
                });
            },
        },
        filters: {}
    }
</script>

<style lang="sass" lang="scss" rel="stylesheet/scss">
    @import "../dvd-base-scss-util/dvd-base-scss-util";

    //底部菜单栏
    .dvd-service-com-footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 50px;
        background: white;
        font-size: 0;
        max-width: $pageMaxWidth;
        z-index: 9;

        .pic {
            max-width: 100%;
        }

        &:before {
            content: '';
            display: block;
            width: 100%;
            border-top: 1px solid #E3DFD8;;
            transform: scaleY(0.5);
        }

        .btns {
            display: flex;
            height: 50px;

            .btn {
                flex: 1;
                display: block;
                text-align: center;

                .pic-title {
                    position: relative;
                    display: inline-block;

                    .pic {
                        display: inline-block;
                        width: 50px;
                        height: 50px;
                        margin-top: 0;

                        .num {
                            position: absolute;
                            top: 0;
                            right: -8px;
                            @include circle(16px);
                            background: #FF4A7D;
                            font-size: 10px;
                            color: white;
                            font-style: normal;
                        }

                    }
                    .title {
                        position: absolute;
                        top: 30px;
                        width: 100%;
                        line-height: 14px;
                        font-size: 10px;
                        color: #999;
                    }

                }
                &.active {

                    .pic-title {

                        .pic {

                            .num {
                            }

                        }
                        .title {
                            color: #FF4A7D;
                        }

                    }
                }

            }
        }
    }
</style>
